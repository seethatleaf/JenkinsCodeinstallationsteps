#!/bin/bash
set -e

echo "ðŸŒ¿ Starting Release Cleanup Job..."

# -------------------------
# Git identity
# -------------------------
git config user.email "jenkins@demo.com"
git config user.name "jenkins-bot"

# -------------------------
# Fetch latest
# -------------------------
git fetch origin

BASE_HASH=$(git rev-parse origin/BASE)
SIT_HASH=$(git rev-parse origin/SITFULL)

echo "BASE  : $BASE_HASH"
echo "SIT   : $SIT_HASH"

echo "Checking differences..."

# -------------------------
# SAME â†’ clean BOTH
# -------------------------
if [ "$BASE_HASH" = "$SIT_HASH" ]; then
    echo "Same â†’ cleaning BOTH branches"

    git checkout BASE
    rm -rf releasefile/*
    git add .
    git commit -m "cleanup BASE" || echo "Nothing to commit"

    git checkout SITFULL
    rm -rf releasefile/*
    git add .
    git commit -m "cleanup SITFULL" || echo "Nothing to commit"

# -------------------------
# DIFFERENT â†’ clean SITFULL only
# -------------------------
else
    echo "Different â†’ cleaning SITFULL only"

    git checkout SITFULL
    rm -rf releasefile/*
    git add .
    git commit -m "cleanup SITFULL" || echo "Nothing to commit"
fi

# -------------------------
# PUSH (IMPORTANT FIX)
# -------------------------
echo "Pushing changes to GitHub..."

git push https://$GIT_USERNAME:$GIT_PASSWORD@github.com/seethatleaf/releasedemoliveforyou.git BASE
git push https://$GIT_USERNAME:$GIT_PASSWORD@github.com/seethatleaf/releasedemoliveforyou.git SITFULL

echo "âœ… Cleanup completed successfully"
