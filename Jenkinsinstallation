#!/bin/bash

set -e

echo "ðŸŒ¿ Configuring git identity"
git config user.email "jenkins@demo.com"
git config user.name "jenkins-bot"

echo "ðŸŒ¿ Fetching branches"
git fetch origin

echo "ðŸŒ¿ Checking differences between BASE and SITFULL"

BASE_HASH=$(git rev-parse origin/BASE:releasefile/user_stories.txt || echo "none")
SIT_HASH=$(git rev-parse origin/SITFULL:releasefile/user_stories.txt || echo "none")

echo "BASE hash: $BASE_HASH"
echo "SIT hash : $SIT_HASH"

if [ "$BASE_HASH" = "$SIT_HASH" ]; then
    echo "âœ… Files same â†’ clean BOTH"
    
    git checkout BASE
    rm -rf releasefile/*
    git commit -am "cleanup BASE" || echo "no changes"
    git push origin BASE

    git checkout SITFULL
    rm -rf releasefile/*
    git commit -am "cleanup SITFULL" || echo "no changes"
    git push origin SITFULL

else
    echo "âš  Files different â†’ clean only SITFULL"

    git checkout SITFULL
    rm -rf releasefile/*
    git commit -am "cleanup SITFULL only" || echo "no changes"
    git push origin SITFULL
fi

echo "ðŸŒ¸ Cleanup completed"
