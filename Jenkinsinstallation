#!/bin/bash
set -e

echo "Starting Release Cleanup Job..."

git config user.email "jenkins@demo.com"
git config user.name "jenkins-bot"

git fetch origin

BASE_HASH=$(git rev-parse origin/BASE)
SIT_HASH=$(git rev-parse origin/SITFULL)

echo "BASE : $BASE_HASH"
echo "SIT  : $SIT_HASH"

echo "Checking differences..."

if [ "$BASE_HASH" = "$SIT_HASH" ]; then
    echo "Same → cleaning BOTH"

    git checkout BASE
    rm -rf releasefile/*
    git add .
    git commit -m "cleanup BASE" || true

    git checkout SITFULL
    rm -rf releasefile/*
    git add .
    git commit -m "cleanup SITFULL" || true

else
    echo "Different → cleaning SITFULL only"

    git checkout SITFULL
    rm -rf releasefile/*
    git add .
    git commit -m "cleanup SITFULL" || true
fi

echo "Pushing changes to GitHub..."

git push -f origin BASE
git push -f origin SITFULL

echo "Cleanup completed successfully"
